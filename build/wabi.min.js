"use strict";window.wabi||(window.wabi={}),wabi.data=function(t,e,i){this.raw=t?t:{},this.id=void 0!==e?e:"",i&&(this.parent=i)},wabi.data.prototype={set:function(t,e){void 0===e?wabi.dataProxy?wabi.dataProxy({id:this.genId(),type:"data",action:"set",value:t}):this.performSet(t):wabi.dataProxy?wabi.dataProxy({id:this.genId(),type:"data",action:"set",key:t,value:e}):this.performSetKey(t,e)},performSet:function(t){if(this.raw=t,this.watchers)for(var e,i=0;this.watchers.length>i;i++)e=this.watchers[i],e.func.call(e.owner,"set",null,t,0,this)},performSetKey:function(t,e){if("string"==typeof e&&"*"===e[0]){var i=new wabi.ref(e,t,this);return this.raw[t]=i,i}var n=t.indexOf(".");if(-1===n)e instanceof Object&&!(e instanceof wabi.data)&&(e=new wabi.data(e,t,this)),this.raw[t]=e;else{for(var a,s=this,l=t.split("."),r=0;l.length-1>r;r++){a=l[r];var h=s.get(a);h||(h=new wabi.data({},a,s),s[a]=h),s=h}a=l[r],e instanceof Object&&!(e instanceof wabi.data)&&(e=new wabi.data(e,a,s)),s.raw[a]=e}if(this.watchers)for(var o,r=0;this.watchers.length>r;r++)o=this.watchers[r],o.func.call(o.owner,"set",t,e,0,this);return e},setKeys:function(t){wabi.dataProxy?wabi.dataProxy({id:this.genId(),type:"data",action:"setkeys",value:t}):this.performSetKeys(t)},performSetKeys:function(t){for(var e in t)this.performSetKey(e,t[e])},add:function(t,e){void 0===e?wabi.dataProxy?wabi.dataProxy({id:this.genId(),type:"data",action:"add",value:t}):this.performAdd(t):wabi.dataProxy?wabi.dataProxy({id:this.genId(),type:"data",action:"add",key:t,value:e}):this.performAddKey(t,e)},push:function(t,e){var i=this.get(t);if(i){if(!(i.raw instanceof Array))return console.warn("(wabi.data) Key `"+t+"` is not an Array"),void 0}else i=new wabi.data([],"content",this),this.raw[t]=i;i.add(e)},performAdd:function(t){if(!(this.raw instanceof Array))return console.warn("(wabi.data.performAdd) Can peform add only to Array"),void 0;if(t instanceof Object&&!(t instanceof wabi.data)&&(t=new wabi.data(t,this.raw.length+"",this)),this.raw.push(t),this.watchers)for(var e,i=0;this.watchers.length>i;i++)e=this.watchers[i],e.func.call(e.owner,"add",null,t,-1,this)},performAddKey:function(t,e){if(!(this.raw instanceof Object))return console.warn("(wabi.data.performAddKey) Can peform add only to Object"),void 0;if(e instanceof Object&&!(e instanceof wabi.data))e=new wabi.data(e,t,this);else if("string"==typeof e&&"*"===e[0]){var i=new wabi.ref(e,t,this);this.raw[t]=e,e=i}if(this.raw[t]=e,"string"==typeof e&&"*"===e[0]){var i=new wabi.ref(e,t,this);this.raw[t]=e,e=i}if(this.watchers)for(var n,a=0;this.watchers.length>a;a++)n=this.watchers[a],n.func.call(n.owner,"add",t,e,-1,this)},remove:function(t){void 0===t?this.parent.remove(this.id):wabi.dataProxy?wabi.dataProxy({id:this.genId(),type:"data",action:"remove",key:t}):this.performRemove(t)},performRemove:function(t){var e=this.raw[t];if(delete this.raw[t],e instanceof wabi.data){var i=e.refs;if(i){for(var n=0;i.length>n;n++)i[n].$remove();e.refs=null}}else e instanceof wabi.ref&&(e=e.instance);if(this.watchers)for(var a,n=0;this.watchers.length>n;n++)a=this.watchers[n],a.func.call(a.owner,"remove",t,e,-1,this)},removeItem:function(t,e){var i=this.raw[t];if("object"==typeof i&&(i instanceof Array?i.splice(e,1):delete i[e],this.watchers))for(var n,a=0;this.watchers.length>a;a++)n=this.watchers[a],n.func.call(n.owner,"removeItem",t,null,e,this)},get:function(t){if("*"===t)return new wabi.data(this.raw,this.id,this.parent);if("@"===t)return this.id;var e;if(isNaN(t)||""===t){var i=t.indexOf(".");if(-1===i){if(e=this.raw[t])if("object"!=typeof e||e instanceof wabi.data){if("string"==typeof e&&"*"===e[0])return e=new wabi.ref(e,t,this),this.raw[t]=e,e}else e=new wabi.data(e,t+"",this),this.raw[t]=e}else{var n=t.split(".");e=this;for(var a=0;n.length>a;a++)e=e.getItem(n[a])}}else e=this.raw[0|t],"object"!=typeof e||e instanceof wabi.data||(e=new wabi.data(e,t+"",this),this.raw[t]=e);return e},getItem:function(t){if("*"===t)return new wabi.data(this.raw,this.id,this.parent);var e;return isNaN(t)||""===t?(e=this.raw[t],e||this.raw.content&&(e=this.raw.content[t])):e=this.raw[0|t],"object"!=typeof e||e instanceof wabi.data||(e=new wabi.data(e,t+"",this),this.raw[t]=e),e},getFromKeys:function(t){for(var e=this,i=0;t.length>i;i++)if(e=e.get(t[i]),!e)return null;return e},genId:function(){if(!this.parent)return this.id;var t=this.id,e=this.parent;do{if(!e.id)return t;t=e.id+"."+t,e=e.parent}while(e);return t},watch:function(t,e){return t?e?(this.watchers?this.watchers.push(new this.Watcher(e,t)):this.watchers=[new this.Watcher(e,t)],void 0):(console.warn("(wabi.data.watch) Invalid owner passed"),void 0):(console.warn("(wabi.data.watch) Invalid callback function passed"),void 0)},unwatch:function(t,e){if(this.watchers)for(var i=this.watchers.length,n=0;i>n;n++){var a=this.watchers[n];if(a.owner===e&&a.func===t)return this.watchers[n]=this.watchers[i-1],this.watchers.pop(),void 0}},sync:function(){if(this.watchers)for(var t=0;this.watchers.length>t;t++){var e=this.watchers[t];e.func.call(e.owner,"sync",null,null,0,this)}},__syncAsArray:function(t){if(this.raw=t,this.watchers)for(var e=0;this.watchers.length>e;e++){var i=this.watchers[e];i.func.call(i.owner,"set",null,t,0,this)}},__syncAsObject:function(t){this.raw={};for(var e in t){var i=this.raw[e],n=t[e];if(void 0===i?this.raw[e]=n:i===n&&(i=n),this.watchers)for(var a=0;this.watchers.length>a;a++){var s=this.watchers[a];s.func.call(s.owner,"set",e,n,0,this)}}},removeRef:function(t){if(!this.refs)return console.warn("(wabi.data.removeRef) No references created from this item"),void 0;var e=this.refs.indexOf(t);this.refs[e]=this.refs[this.refs.length-1],this.refs.pop()},toJSON:function(){return this.raw},Watcher:function(t,e){this.owner=t?t:null,this.func=e},watchers:null,parent:null,refs:null},wabi.ref=function(t,e,i){this.id=e,this.path=t,this.parent=i;var n=t.slice(1);this.instance=wabi.globalData.raw.assets.get(n),this.instance?this.instance.refs?this.instance.refs.push(this):this.instance.refs=[this]:console.warn("(wabi.ref) Invalid ref: "+n)},wabi.ref.prototype={remove:function(){this.instance.removeRef(this),this.instance=null,this.parent.remove(this.id)},$remove:function(){this.parent.remove(this.id)},toJSON:function(){return this.path}},wabi.element.basic=function(t,e){this.create&&this.create(e),this.domElement||(this.domElement=document.createElement(this.tag?this.tag:this._metadata.name)),this.domElement.holder=this,this._$=new this._metadata.stateCls,t&&(this.parent=t);var i=this._metadata.events;if(i)for(var n=0;i.length>n;n++)this._addEvent(i[n]);this.prepare&&this.prepare()},wabi.element("basic",{create:null,element:function(t,e){var i=this._metadata.elements[t];if(!i)return console.warn("(wabi.element.basic.element) Invalid slot id: "+t),null;if(!e){var n=this.elements[t];return n&&n.remove(),this.elements[t]=null,null}if("string"==typeof e){if(e=wabi.createElement(e),!e)return this.elements[t]=null,null}else if(!(e instanceof wabi.element.basic))return console.warn("(wabi.element.basic.element) Invalid element passed should be string or extend `wabi.element.basic`"),this.elements[t]=null,null;var a=i.params;for(var s in a)e[s]=a[s];e.flags|=this.Flag.SLOT,e.slotId=t,this.elements[t]=e;var l=i.watch;for(var s in l){var r=l[s],h=this[r];h?e.watch(s,h,this):console.warn("(wabi.element.basic.element) Slot `"+t+"` watching on `"+s+"` uses undefined function: "+r)}var o=this._metadata.elementsLinked[t];o&&(e._parentLink=o,this._$[o]=e);var c=this._metadata.elementsBinded[t];c&&(e.bind=c),i.state&&(e.$=i.state);var d=this.domElement.childNodes[i.slot];return d?this.appendBefore(e,d.holder):e.appendTo(this),e},_setup:function(){var t=this._metadata.elements;if(t){this.elements||(this.elements={});for(var e in t)this.element(e,t[e].type)}if(this.flags&this.Flag.INITIAL_SETUP_DONE){var i=this._metadata.states;for(var e in i)this._processState(e,i[e])}else{var i=this._metadata.statesInitial;for(var e in i)this._processState(e,i[e],!0);this.flags|=this.Flag.INITIAL_SETUP_DONE}this.setup&&this.setup()},prepare:null,setup:null,append:function(t){t.appendTo(this)},appendTo:function(t){if(!t)return console.warn("(wabi.element.basic.appendTo) Invalid parent passed");if(this._parent)return console.warn("(wabi.element.basic.appendTo) Element is already added to different parent");var e;t instanceof Element?(e=t.holder,e||(e=wabi.createElement("wrapped",null,t),t.holder=e)):e=t,e.children?e.children.push(this):e.children=[this],this._parent=e,e._data&&"*"!==e.bind&&(this.region||(this.data=e._data)),e.domElement&&this.flags&this.Flag.ENABLED&&e.domElement.appendChild(this.domElement)},appendBefore:function(t,e){return this.children?(this.children.push(t),this._data&&"*"!==this.bind&&(t.region||(t.data=this._data)),t._parent=this,this.flags&this.Flag.ENABLED&&this.domElement.insertBefore(t.domElement,e.domElement),void 0):console.error("(wabi.element.")},_remove:function(){if(this.cleanup&&this.cleanup(),this.removeAll(),this.flags&this.Flag.ENABLED&&this._parent&&this._parent.domElement.removeChild(this.domElement),this._parent){var t=this._parent.children,e=t.indexOf(this);e>-1&&(t[e]=t[t.length-1],t.pop()),this._parentLink&&(this._parent._$[this._parentLink]=null,this._parentLink=null),this.slotId&&(this._parent.elements[this.slotId]=null,this.slotId=null),this._parent.onChildRemove&&this._parent.onChildRemove(this),this._parent=null}for(this._data&&(this.data=null),this.domElement.className&&(this.domElement.className="");this.domElement.attributes.length>0;)this.domElement.removeAttribute(this.domElement.attributes[0].name);this.flags=0,this._bind=null,this._watching&&(this._watching=null),this.listeners&&(this.listeners=null),this.childrenListeners&&(this.childrenListeners=null)},removeAll:function(){if(this.children)for(var t=this.children.length-1;t>-1;t--)wabi.removeElement(this.children[t])},remove:function(){wabi.removeElement(this)},removeChildWithData:function(t){if(this.children)for(var e=0;this.children.length>e;e++){var i=this.children[e];i.data===t&&i.remove()}},onChildRemove:null,attrib:function(t,e){return void 0===e?this.domElement.getAttribute(t):(this.domElement.setAttribute(t,e),e)},removeAttrib:function(t){this.domElement.removeAttribute(t)},style:function(t,e){return void 0===this.domElement.style[t]?(console.warn("(wabi.element.basic.style) Invalid DOM style:",t),null):void 0===e?this.domElement.style[t]:(this.domElement.style[t]=e,e)},removeStyle:function(t){this.domElement.style.removeProperty(t)},setCls:function(t,e){e?this.domElement.classList.add(t):this.domElement.classList.remove(t)},get:function(t){if("#"===t[0]){var e=this.domElement.querySelector(t);if(e)return e.holder}else if("function"==typeof t){var i=t.prototype.tag||t.prototype._metadata.name,n=this.domElement.querySelectorAll(i),a=n.length;if(a>0){for(var s=Array(a),l=0;a>l;l++)n[l].holder instanceof t&&(s[l]=n[l].holder);return s}}else{var n=this.domElement.querySelectorAll(t),a=n.length;if(a>0){for(var s=Array(a),l=0;a>l;l++)s[l]=n[l].holder;return s}}return null},on:function(t,e,i,n){if(void 0===e)return console.warn("(wabi.element.basic.on) Invalid callback passed to event: "+t),void 0;if("function"==typeof e&&(n=i,i=e,e=null),!i)return console.warn("(wabi.element.basic.on) Invalid callback function: "+t),void 0;var a,s;if(e){if("string"!=typeof e||"#"!==e[0]){if(this.childrenListeners||(this.childrenListeners={}),e instanceof Array)for(var l=0;e.length>l;l++)this._onChildListen(t,e[l],i,n);else this._onChildListen(t,e,i,n);return}if(a=this.get(e),!a)return}else a=this;s=a.listeners,s||(s={},a.listeners=s);var r=s[t];r||(r=[],s[t]=r,a._addEvent(t)),r.push(i.bind(n))},emit:function(t,e){var i;if(this.listeners){var n=this.listeners[t];if(n){i=new wabi.event(t,this,e),this._preventableEvents[t]&&e.preventDefault();for(var a=0;n.length>a;a++)n[a](i)}}},emitEx:function(t){if(this.listeners){var e=this.listeners[t.name];if(e)for(var i=0;e.length>i;i++)e[i](t)}},checkParentListeners:function(t,e){var i=this.childrenListeners[t];if(i)for(var n=0;i.length>n;n++)i[n](e);this._parent&&this.checkParentListeners(t,e)},_onChildListen:function(t,e,i,n){var a=this.childrenListeners[e];a||(a={},this.childrenListeners[e]=a);var s=a[t];s?s.push(i.bind(n)):(s=[i.bind(n)],a[t]=s),null===this.domElement["on"+t]&&this._addEvent(t)},off:function(){},set id(t){t?this.domElement.id=t:this.domElement.removeAttribute("id")},get id(){return this._id},set bind(t){if(t){var e,i=this._metadata.statesLinked;if("string"==typeof t){var e=i.value;void 0!==e&&(e=this.elements[e],e&&(e.bind=t,t=null))}else for(var n in t){var a=i[n];if(void 0!==a){var e=this.elements[a];e&&(e.bind=t[n],delete t[n])}}}this._bind=t,this.updateBindings()},get bind(){return this._bind},set hidden(t){if(t){if(this.flags&this.Flag.HIDDEN)return;this.flags|=this.Flag.HIDDEN,this.domElement.classList.add("hidden")}else{if(0===(this.flags&this.Flag.HIDDEN))return;this.flags&=~this.Flag.HIDDEN,this.domElement.classList.remove("hidden")}},get hidden(){return(this.flags&this.Flag.HIDDEN)===this.Flag.HIDDEN},set enabled(t){if(t){if(this.flags&this.Flag.ENABLED)return;this.flags|=this.Flag.ENABLED,this._parent&&this._parent.domElement.appendChild(this.domElement)}else{if(0===(this.flags&this.Flag.ENABLED))return;this.flags&=~this.Flag.ENABLED,this._parent&&this._parent.domElement.removeChild(this.domElement)}},get enabled(){return(this.flags&this.Flag.ENABLED)===this.Flag.ENABLED},set $(t){if("object"==typeof t)for(var e in t)this.setState(e,t[e]);else this.setState("value",t)},get $(){return this._$},set parent(t){this._parent!==t&&(t?this.appendTo(t):this._parent&&this._parent.remove(this))},get parent(){return this._parent},set data(t){if(t instanceof wabi.ref){if(this._data===t.instance)return;this._data&&this.flags&this.Flag.WATCHING&&(this.flags&=~this.Flag.WATCHING,this._data.unwatch(this.handleDataChange,this)),this._data=t.instance,this.ref=t}else{if(this._data===t)return;this._data&&this.flags&this.Flag.WATCHING&&(this.flags&=~this.Flag.WATCHING,this._data.unwatch(this.handleDataChange,this)),this._data=t}if(this.updateBindings(),this.children)for(var e=0;this.children.length>e;e++){var i=this.children[e];i.region||(i.data=t)}},get data(){return this._data},html:function(t){return void 0===t?this.domElement.innerHTML:this.children&&this.children.length>0?(console.warn("(wabi.element.basic.html) Can`t set html content for element `"+this._metadata.name+"` that has children"),null):(this.domElement.innerHTML=t,t)},updateBindings:function(){if(this._data)if(this._bind)if(0===(this.flags&this.Flag.WATCHING)&&(this.flags|=this.Flag.WATCHING,this._data.watch(this.handleDataChange,this)),"string"==typeof this._bind)this.updateDataValue("value",this._bind);else for(var t in this._bind)this.updateDataValue(t,this._bind[t]);else this._data&&this.flags&this.Flag.WATCHING&&(this.flags&=~this.Flag.WATCHING,this._data.unwatch(this.handleDataChange,this))},updateDataValue:function(t,e){var i=this._data.get(e);void 0!==i&&this.setState(t,i)},_addEvent:function(t){var e=this["handle_"+t];if("click"===t)this.domElement.onclick=this._processClick.bind(this),e&&(this._onClick=e.bind(this));else if("dblclick"===t)this.domElement.onclick=this._processClicking.bind(this),e&&(this._onDblClick=e.bind(this));else{var i="on"+t;if(null===this.domElement[i]){var n=this;this.domElement[i]=function(i){n._processEvent(t,e,i)}}}},_onClick:null,_onDblClick:null,_processClick:function(t){var e=new wabi.event("click",this,t),i=t.target.holder;i&&i!==this&&(this._processChildEvent(i._metadata.name,e),this._processChildEvent("*",e)),this._onClick&&this._onClick(e),this.emitEx(e)},_processClicking:function(t){var e;e=0===t.detail%2?new wabi.event("dblclick",this,t):new wabi.event("click",this,t);var i=t.target.holder;return i!==this?(e.element=i,this._processChildEvent(i._metadata.name,e),this._processChildEvent("*",e),void 0):(0===t.detail%2?(this._onDblClick&&this._onDblClick(e),this.emitEx(e)):(this._onClick&&this._onClick(e),this.emitEx(e)),void 0)},_processEvent:function(t,e,i){var n=new wabi.event(t,this,i);this._preventableEvents[t]&&(i.preventDefault(),i.stopPropagation());var a=i.target.holder;return a!==this?(n.element=a,this._processChildEvent(a._metadata.name,n),this._processChildEvent("*",n),void 0):(e&&e.call(this,n),this.emitEx(n),void 0)},_processChildEvent:function(t,e){if(this.childrenListeners){var i=this.childrenListeners[t];if(i){var n=i[e.name];if(n)for(var a=0;n.length>a;a++)n[a](e);else;}}},handleDataChange:function(t,e,i,n){var a=this._bind,s=typeof a;if("string"===s){if(e!==a&&"*"!==a)return;this._setActionState(t,"value",i,n)}else if("object"===s){if(void 0===a[e])return;this._setActionState(t,a[e],i,n)}},_updateParentStateFunc:function(t,e){this._parentLink&&"value"===t&&(e=this._parent._updateParentStateFunc(this._parentLink,e));var i=this["set_"+t];if(i){var n=i.call(this,e);void 0!==n&&(e=n)}if(this.watching){var i=this.watching[t];i&&i.call(this._parent,e)}return e},_updateState:function(t,e){if(this._parentLink&&"value"===t&&(e=this._parent._updateParentStateFunc(this._parentLink,e)),this._data&&this._bind)if("string"==typeof this._bind)"value"===t?this._data.set(this._bind,e):this._setActionState("set",t,e);else{var i=this._bind[t];i?data.set(i,e):this._setActionState("set",i,e)}else this._setActionState("set",t,e)},_setActionState:function(t,e,i){if(void 0!==this._$[e]){var n=this[t+"_"+e];if(n){var a=n.call(this,i);void 0!==a&&(i=a)}if(this.watching){var n=this.watching[e];n&&n.call(this._parent,i)}"set"===t&&(this._$[e]=i)}},setState:function(t,e){var i=this._$[t];if(void 0!==i){this._parentLink&&"value"===t&&(e=this._parent.setStateParent(this._parentLink,e));var n=this["set_"+t];if(n){var a=n.call(this,e);void 0!==a&&(e=a)}if(i instanceof wabi.element.basic)i.setState("value",e);else{if(this.watching){var n=this.watching[t];if(n){var a=n.call(this._parent,e);void 0!==a&&(e=a)}}this._$[t]=e}}},setStateParent:function(t,e){this._parentLink&&"value"===t&&(e=this._parent.setStateParent(this._parentLink,e));var i=this["set_"+t];return i&&i.call(this,e),e},_processState:function(t,e,i){if(void 0!==e&&(i||this._$[t]!==e)){var n=this["set_"+t];if(n){var a=n.call(this,e);void 0!==a&&(e=a)}var s=this._metadata.statesLinked[t];if(s)return this.elements[s]._processState("value",e);if(this.watching){var n=this.watching[t];n&&n.call(this._parent,e)}return this._$[t]=e,e}},watch:function(t,e){this.watching||(this.watching={}),this.watching[t]=e},unwatch:function(t){this.watching[t]&&(this.watching[t]=null)},toJSON:function(){return this._$},Flag:{NONE:0,ENABLED:2,WATCHING:4,ELEMENT:8,SLOT:16,HIDDEN:32,INITIAL_SETUP_DONE:64},_metadata:null,elements:null,domElement:null,_id:"",_$:null,_parent:null,_data:null,_bind:null,ref:null,_parentLink:null,slotId:null,watchers:null,watching:null,flags:0,tag:null,listeners:null,children:null,childrenListeners:null,_preventableEvents:{contextmenu:!0},region:!1}),Element.prototype.holder=null,wabi.element("button",{set_value:function(t){this.html(t)},set_width:function(t){t>0?this.style("flex","1 1 "+t+"px"):this.style("flex")&&this.style("flex","")},width:0}),wabi.element("canvas",{prepare:function(){this.ctx=this.domElement.getContext("2d")},ctx:null}),wabi.element("caret",{state:{value:!0},setup:function(){this.setCls("fa",!0)},toggle:function(){this.$value=!this.$value},set_value:function(t){t?(this.setCls("fa-caret-right",!1),this.setCls("fa-caret-down",!0)):(this.setCls("fa-caret-down",!1),this.setCls("fa-caret-right",!0))},handle_click:function(){this.toggle()}}),wabi.element("checkbox",{state:{value:!1},setup:function(){this.attrib("tabindex","0")},set_value:function(t){this.setCls("active",t)},handle_click:function(){this.toggle()},handle_keydown:function(t){32===t.domEvent.keyCode&&this.toggle()},toggle:function(){this.$value=!this.$value}}),wabi.element("content",{set_value:function(t){this.removeAll(),this.$loadValue(t)},$loadValue:function(t){if(t){var e=typeof t;if("object"===e)if(t instanceof Array)for(var i=0;t.length>i;i++){var n=t[i];if("string"==typeof n){var a=wabi.getFragment(n);this.$loadValue(a)}else this.$loadState(n)}else this.$loadState(t);else{var a=wabi.getFragment(t);this.$loadValue(a)}}},$loadState:function(t){if(!t.type)return console.warn("(wabi.elements.content) Undefined element type"),void 0;var e=wabi.createElement(t.type,this);if(e)for(var i in t)"type"!==i&&(e[i]=t[i])},set padding(t){t>0?this.style("margin",t+"px"):this.style("margin")&&this.style("margin","")},get padding(){return this._padding},set height(t){this.style("height",t+"px")},get height(){return this._height},_padding:0,_height:0}),wabi.element("desc",{elements:{content:{type:"content",link:"value"},name:{type:"text",link:"name"}}}),wabi.element("div",{}),wabi.element("dropdown",{state:{value:"",dataset:null,filter:null,sort:!1,emptyOption:!1},elements:{input:{type:"staticInput",bind:"value",region:!0},caret:{type:"icon",$value:"fa-caret-down"},list:"list"},setup:function(){this.elements.list.on("click",this.selectOption,this),this.on("click","staticInput",this.openMenu,this),wabi.on("click",this.hideMenu,this)},cleanup:function(){wabi.off("click",this.hideMenu,this)},set_value:function(t){if(!this._dataset)return this.elements.input.data=null,this.elements.input.$value="","";var e=this._dataset.get(t);return e?(this.elements.input.data=e,void 0):(this.elements.input.data=null,this.elements.input.$value="","")},set_dataset:function(t){return t?(this._dataset=wabi.globalData.get(t),this._dataset?void 0:(console.log("(wabi.element.dropdown.set_dataset) Data set not found: "+t),void 0)):(this._dataset=null,void 0)},openMenu:function(t){t.stop();var e=this.elements.list;e.removeAll(),this._dataset&&(e.$value=this.genDataBuffer(),e.hidden=!1)},genDataBuffer:function(){var t={},e=new wabi.data(t),i=this._dataset.raw;this.$emptyOption&&(t[""]={value:""});for(var n in i)t[n]=i[n];return e},hideMenu:function(){this.elements.list.hidden=!0},selectOption:function(t){t.stop(),this.$value=this.elements.list.cache.selected.data.id,this.hideMenu()},_dataset:null}),wabi.element("error",{state:{types:{}},set_value:function(t){if(!t)return this.html(""),void 0;var e=this.$types[t];return e?(this.html(e),void 0):(this.html(""),void 0)},set_types:function(){this.$value&&this.set_value(this.$value)}}),wabi.element("group",{params:{padding:2},set_value:function(){},set_padding:function(t){this.style("margin",t+"px")}}),wabi.element("header",{set_value:function(t){this.html(t)}}),wabi.element("headerEx",{elements:{caret:{type:"caret",link:"open"},text:{type:"text",link:"value"}},prepare:function(){this.on("click","*",this.handle_click,this)},handle_click:function(){this.elements.caret.toggle()},tag:"header"}),wabi.element("html",{set_value:function(t){this.domElement.innerHTML=t;for(var e,i,n,a,s,l=document.createNodeIterator(this.domElement,NodeFilter.SHOW_TEXT);e=l.nextNode();)i=e.nodeValue,a=i.indexOf("{"),-1!==a&&(s=i.indexOf("}"),-1!==s&&(n=i.slice(a+1,s),this.genStateFuncs(n)))}}),wabi.element("icon",{setup:function(){this.hidden=!0,this.attrib("class","fa")},set_value:function(t){this.setCls(t,!0),this.hidden=!1}}),wabi.element("iframe",{set_value:function(t){this.domElement.src=t},handle_load:function(){this.wnd=this.domElement.contentWindow},wnd:null}),wabi.element("input",{set_value:function(t){this.domElement.value=t},set inputType(t){this.attrib("type",t)},get inputType(){return this.attrib("type")},set placeholder(t){this.domElement.placeholder=t?t:""},get placeholder(){return this.domElement.placeholder},set readOnly(t){this.domElement.readOnly=t},get readOnly(){return this.domElement.readOnly},set editable(t){t?this.removeAttrib("readonly"):this.attrib("readonly","")},get editable(){return void 0===this.attrib("readonly")},handle_change:function(){this.$value=this.domElement.value},tag:"input"}),wabi.element("staticInput","input",{setup:function(){this.editable=!1}}),wabi.element("label",{elements:{name:{type:"text",link:"name"},content:{type:"content",link:"value"}}}),wabi.element("list",{setup:function(){this.cache={itemElements:[],selectable:!0,selected:null,dragging:null}},set_value:function(t){if(this.removeAll(),t&&(this.set_placeholder(null),t instanceof Object))if(t instanceof Array)for(var e=0;t.length>e;e++)this.add_value(t.get(e));else{var i=t.raw;for(var n in i)this.add_value(t.get(n))}this.children&&0!==this.children.length||this.set_placeholder(this.placeholder)},add_value:function(t){this.set_placeholder(null);var e=wabi.createElement("listItemHolder",this);e.$item=this.itemCls,e.data=t},remove_value:function(t){if(this.children)for(var e=0;this.children.length>e;e++){var i=this.children[e];if(i.data===t)return this.remove(i),void 0}},set_placeholder:function(t){t?this.domElement.innerHTML||(this.setCls("empty",!0),this.html(t)):(this.setCls("empty",!1),this.children&&0!==this.children.length||this.html(""))},set_itemCls:function(t){if(!t)return"listItem";var e=wabi.element[t];return e?void 0:(console.warn("(wabi.elements.list.set_itemCls) No such element found: "+t),"listItem")},createFolder:function(){var t=wabi.createElement("listItem",this);t.value="Folder",t.folder=!0},set select(t){this.cache.selectable&&(t.select=!0)},get select(){return this.cache.selected},set selectable(t){this.cache.selectable!==t&&(this.cache.selectable=t,!t&&this.cache.selected&&(this.cache.selected=!1))},get selectable(){return this.cache.selectable},cache:null,itemCls:"listItem"}),wabi.element("listItemHolder",{elements:{item:{type:null,watch_open:"handleItemOpen"},list:{type:"list",bind:"content",link:"content"}},setup:function(){this.attrib("draggable","true")},set_item:function(t){this.elements.list.itemCls=t,this.element("item",t)},set_content:function(t){console.log("set_content",t),this.elements.item.$folder=t?!0:!1},add_content:function(t){console.log("add_content",t)},updateOpen:function(){this.elements.list.hidden=!this.itemElement.open},handleItemOpen:function(t){this.elements.list.hidden=!t},handle_dragstart:function(t){this.setCls("dragging",!0),this.elements.item.$folder&&(this.elements.item.$open=!1),t.domEvent.dataTransfer.effectAllowed="move"},handle_dragend:function(){this.setCls("dragging",!1)},handle_dragenter:function(){this.setCls("dragover",!0)},handle_dragleave:function(){this.setCls("dragover",!1)},tag:"holder",itemElement:null,draggable:!1,region:!0}),wabi.element("listItem",{elements:{folder:null,word:{type:"text",link:"value",bind:"value"}},setup:function(){this.attrib("tabindex","0"),this.on("click","*",function(){this.select=!0},this),this.editable=!1},cleanup:function(){this.cache.selected===this&&(this.cache.selected=null)},set select(t){t?(this.cache.selected&&(this.cache.selected.select=!1),this.cache.selected=this):this.cache.selected!==this&&(this.cache.selected=null),this.setCls("selected",t)},get select(){return this===this.cache.selected},set_folder:function(t){this.slot("folder",t?"caret":null),t&&(this.open=!1)},handle_click:function(){this.select=!0},handle_dblclick:function(){this.folder&&(this.open=!this.open)},get cache(){return this.parent.parent.cache},tag:"item"}),wabi.element("editableListItem","listItem",{elements:{folder:null,word:{type:"word",link:"value",bind:"value"}}}),wabi.element("loader",{setup:function(){this.hidden=!0}}),wabi.element("menubar",{elements:{left:{type:"content",link:"value"},center:{type:"content",link:"center"},right:{type:"content",link:"right"}},setup:function(){this.elements.left.setCls("left",!0),this.elements.center.setCls("center",!0),this.elements.right.setCls("right",!0)}}),wabi.element("number",{state:{value:0,min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},prepare:function(){this.attrib("type","text")},set_value:function(t){return isNaN(t)?console.log("num",t):(this.min>t&&(t=this.min),t>this.max&&(t=this.max)),this.domElement.value=t+"",t},set_min:function(){this.$value=this.$value},set_max:function(){this.$value=this.$value},handle_keydown:function(t){var e=t.domEvent;if(!e.ctrlKey){var i=e.keyCode;if(!(i>=37&&40>=i)){i>=96&&105>=i&&(i-=48);var n=e.target.value;switch(i){case 8:case 46:return;case 27:return e.target.value=this._value,void 0;case 187:case 189:return 0!==e.target.selectionStart&&0!==n.length&&e.preventDefault(),void 0;case 190:var a=n.indexOf(".");return-1!==a&&e.preventDefault(),void 0}var s=String.fromCharCode(i);isNaN(s)&&e.preventDefault()}}},handle_change:function(){this.$value=parseFloat(this.domElement.value)},tag:"input"}),wabi.element("panel",{state:{header:"Panel"},elements:{header:{type:"header",link:"header"},content:{type:"content",link:"value"}},set width(t){this.style("width",t+"px")},get width(){return this._width},set height(t){this.style("min-height",t+"px")},get height(){return this._height},_width:0,_height:0}),wabi.element("row",{set_value:function(t){if(this.removeAll(),t)for(var e=0;t.length>e;e++){var i=t[e],n=wabi.createElement(i.type,this);if(n)for(var a in i)"type"!==a&&(n[a]=i[a])}}}),wabi.element("span",{}),wabi.element("tag",{set_value:function(t){console.log("tag",t),t?this.html(t):this.html("")}}),wabi.element("template",{process_value:function(t){this.removeAll();for(var e=wabi.element,i=0;t.length>i;i++){var n=t[i];if(n.type){var a=e[n.type];if(a){var s=new a(this);s.cfg=n}else console.warn("(editor.element.template) Undefined element type: "+n.type)}else console.warn("(editor.element.template) Undefined element type")}}}),wabi.element("text",{state:{value:""},set_value:function(t){this.html(t)}}),wabi.element("upload",{prepare:function(){this.attrib("type","file"),this.attrib("multiple",""),this.attrib("directory","")},set_value:function(t){this.domElement.value=t},open:function(){this.domElement.click()},get files(){return this.domElement.files},tag:"input"}),wabi.element("word",{state:{value:""},prepare:function(){this.attrib("spellcheck","false"),this.attrib("tabindex","0")},set_value:function(t){if(this.html(t),this.$value&&t&&t!==this.$value){this.setCls("highlight",!0);var e=this;setTimeout(function(){e.setCls("highlight",!1)},600)}},set editable(t){this._editable!==t&&(this._editable=t,t||(this.domElement.contentEditable="false"))},get editable(){return this._editable},handle_dblclick:function(){this.editable&&(this.domElement.contentEditable="true",this.domElement.focus(),meta.selectElementContents(this.domElement))},handle_blur:function(){var t=this.html();t?this.$value=t:this.html(this.$value),this.editable&&(this.domElement.contentEditable="false")},handle_keydown:function(t){var e=t.domEvent.keyCode;e>47&&58>e||e>64&&91>e||e>96&&123>e||95===e||189===e||190===e||32===e||8!==e&&(e>=37&&40>=e||(27===e?this.domElement.blur():13===e&&(this.domElement.blur(),this.domElement.scrollIntoView(!0)),t.domEvent.preventDefault()))},handle_change:function(){this.$value=this.html()},_editable:!0}),wabi.element("wrapped",{create:function(t){"string"==typeof t?this.tag=t:t instanceof Element&&(this.tag=t.tagName,this.domElement=t)}}),wabi.event=function(t,e,i){this.name=t,this.element=e,i&&(this.domEvent=i,i.clientX?(this.x=i.clientX,this.y=i.clientY,this.updateElementOffset(event)):(this.x=0,this.y=0))},wabi.event.prototype={updateElementOffset:function(){var t=0,e=0;if(this.element){var i=this.element.domElement;if(i.offsetParent)do"IFRAME"===i.tagName&&(t+=i.offsetLeft,e+=i.offsetTop);while(i=i.offsetParent)}if(this.element&&"IFRAME"===this.element.domElement.tagName){var n=this.element.domElement.getBoundingClientRect();this.x+=n.left,this.y+=n.top}},stop:function(){this.domEvent.preventDefault(),this.domEvent.stopPropagation()},get target(){return this.domEvent.target.holder},domEvent:null,x:0,y:0};var wabi={addTemplate:function(t,e,i){return t?("object"==typeof e&&(i=e,e=null),i.type?this.templates[t]?(console.warn("(wabi.addTemplate) There is already added template with such id: "+i.id),!1):(this.templates[t]=i,!0):(console.warn("(wabi.addTemplate) Invalid template type passed"),!1)):(console.warn("(wabi.addTemplate) Invalid template id passed"),!1)
},createTemplate:function(t){var e=this.templates[t];if(!e)return console.warn("(wabi.createTemplate) Template not found: "+t),null;var i=wabi.createElement(e.type);i.flags|=i.Flag.REGION;for(var n in e)"type"!==n&&(i[n]=e[n]);return i},addFragment:function(t,e,i){return t?this.fragments[t]?(console.warn("(wabi.addFragment) There is already added fragment with such id: "+t),!1):(i||(i=e,e=null),this.fragments[t]=new this.Fragment(t,e,i),!0):(console.warn("(wabi.addFragment) Invalid fragment id passed"),!1)},getFragment:function(t){var e=this.fragments[t];if(!e)return console.warn("(wabi.getTemplate) Could not find fragment with id: "+t),null;if(e.extend){var i=this.extendFragment([],e.extend);return i=this.appendProps(i,e.props)}return e.props},extendFragment:function(t,e){for(var i=0;e.length>i;i++){var n=this.fragments[e[i]];n?(n.extend&&(t=this.extendFragment(t,n.extend)),t=this.appendProps(t,n.props)):console.warn("(wabi.extendFragment) Could not find fragment with id: "+n.id)}return t},appendProps:function(t,e){return e instanceof Array?t=t.concat(e):t.push(e),t},createElement:function(t,e,i){var n,a=this.elementsCached[t];if(a&&a.length>0)n=a.pop(),n&&(n.flags=n.flagsInitial,e&&(n.parent=e));else{var s=this.element[t];if(!s)return console.warn("(editor.createElement) No such element found: "+t),null;n=new this.element[t](e,i)}return n._setup(),n},removeElement:function(t){if(!(t&&t instanceof wabi.element.basic))return console.warn("(wabi.removeElement) Invalid element passed");t._remove();var e=this.elementsCached[t._metadata.name];e?e.push(t):(e=[t],this.elementsCached[t._metadata.name]=e)},on:function(t,e,i){if(!e)return console.warn("(wabi.on) Invalid callback function passed"),void 0;var n=this.listeners[t];if(n)n.push(new this.Watcher(i,e));else{var a="on"+t;if(void 0===window[a])return console.warn("(wabi.on) No such global event available: "+t),void 0;n=[new this.Watcher(i,e)],this.listeners[t]=n,window[a]=function(e){for(var i=new wabi.event(t,null,e),a=0;n.length>a;a++){var s=n[a];s.func.call(s.owner,i)}}}},off:function(t,e,i){if(!e)return console.warn("(wabi.on) Invalid callback function passed");var n=this.listeners[t];if(!n)return console.warn("(wabi.off) No listeners found for event: "+t);for(var a=n.length,s=0;a>s;s++){var l=n[s];if(l.func===e&&l.owner===i){n[s]=n[a-1],n.pop();break}}},element:function(t,e,i){if(void 0===i&&(i=e,e=null),this.elementDefs[t])return console.warn("(wabi.element) There is already defined element with such name: "+t),void 0;var n=new this.ElementDef(i,e);this.elementDefs[t]=n,"basic"===t?this.compileBasicElement(i,e):this.compileElement(t,i,e)},genPrototype:function(t,e,i){if(e){var n=this.elementDefs[e];if(!n)return console.warn("(wabi.genPrototype) Extended class not found: "+e),void 0;var a={};this.assignObj(a,n.props),this.assignObj(a,i),i=a}var s={},l={},r={},h={},o={},c=[],d={},f=0;if(i.elements){var u=i.elements;for(var m in u){var v=m,p=u[v],w={},g={},b={},_=null,y=null,E=null;if(p)if("string"==typeof p)y=p;else{p.type&&(y=p.type),p.link&&(_=p.link),p.bind&&(E=p.bind);var k="watch_",C=k.length;for(var I in p)"type"!==I&&"link"!==I&&"bind"!==I&&("$"===I[0]?w[I.slice(1)]=p[I]:I.indexOf(k)>-1?g[I.slice(C)]=p[I]:b[I]=p[I])}else;var x={type:y,link:_,slot:f++,state:w,watch:g,params:b};_&&(l[_]=m,r[m]=_),E&&(h[m]=E),o[v]=x}delete i.elements}var A=i.state,N=A;if(A)for(var I in A)s[I]=A[I];for(var I in i){var D=Object.getOwnPropertyDescriptor(i,I);if(D.get||D.set)Object.defineProperty(d,I,D);else{var L=i[I],O=typeof L;if("function"===O){var $=I.split("_");if($.length>1&&""!==$[0]){var S=$[1];"handle"!==$[0]?void 0===s[S]&&(s[S]=null):c.push(S)}}d[I]=L}}var F;if("basic"!==t){var T=this.element.basic.prototype._metadata,P=T.states;F=Object.assign({},P),F=Object.assign(F,s)}else F=s;var j={};for(var I in h)j[h[I]]=I;var B=new this.metadata(t);return B.states=F,B.statesLinked=l,B.statesInitial=N,B.elementsLinked=r,B.elementsBinded=h,B.bindsForElement=j,f>0&&(B.elements=o),c.length>0&&(B.events=c),d._metadata=B,d},compileBasicElement:function(t,e){var i=this.genPrototype("basic",e,t);i.flagsInitial=i.Flag.ENABLED,i.flags=i.flagsInitial,this.element.basic.prototype=i},compileElement:function(t,e,i){function n(t,e){wabi.element.basic.call(this,t,e)}function a(){}var s=this.genPrototype(t,i,e);n.prototype=Object.create(this.element.basic.prototype),n.prototype.constructor=n;var l=n.prototype;for(var r in s){var h=Object.getOwnPropertyDescriptor(s,r);h.get||h.set?Object.defineProperty(l,r,h):l[r]=s[r]}var o=s._metadata,c=o.statesLinked,d=o.states,f={};for(var r in c)d[r]||(d[r]=void 0);for(var r in d){var u=d[r],m=typeof u,v=c[r];if(v)f[r]=null,this.defStateLink(l,r,v);else{switch(m){case"string":case"object":f[r]=null;break;case"number":f[r]=0;break;case"boolean":f[r]=!1;break;default:console.warn("(wabi.compileElement) Unhandled stateValueType `"+m+"` for element: "+t),f[r]=null}this.defState(l,r)}}a.prototype=f,o.stateCls=a,this.element[t]=n},defState:function(t,e){Object.defineProperty(t,"$"+e,{set:function(t){this._updateState(e,t)},get:function(){return this._$[e]}})},defStateLink:function(t,e,i){Object.defineProperty(t,"$"+e,{set:function(t){var n=this.elements[i];n?n.$value=t:this._updateState(e,t)},get:function(){return this.elements[i].$value}})},addDataset:function(t,e){return this.datasets[t]?(console.warn("(wabi.addDataset) There is already dataset with id: "+t),void 0):(this.datasets[t]=e instanceof wabi.data?e.data:e,void 0)},assignObj:function(t,e){for(var i in e){var n=Object.getOwnPropertyDescriptor(e,i);n.get||n.set?Object.defineProperty(t,i,n):t[i]=e[i]}},metadata:function(t){this.name=t,this.states=null,this.stateCls=null,this.statesLinked=null,this.elements=null,this.elementsLinked=null,this.elementsBinded=null,this.events=null},Watcher:function(t,e){this.owner=t?t:null,this.func=e},Fragment:function(t,e,i){this.id=t,this.props=i,this.extend=e?"string"==typeof e?[e]:e:null},ElementDef:function(t,e){this.props=t,this.extend=e},globalData:{},elementsCached:{},elementDefs:{},datasets:{},fragments:{},templates:{},listeners:{}};